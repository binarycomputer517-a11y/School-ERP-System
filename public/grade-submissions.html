<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Submissions | ERP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background: #f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; }
        .grade-card { background: white; border-radius: 20px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .status-badge { padding: 5px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; }
        .bg-pending { background: #fef3c7; color: #92400e; }
        .bg-graded { background: #dcfce7; color: #166534; }
    </style>
</head>
<body>
    <div class="container py-5">
        <header class="mb-4 d-flex justify-content-between align-items-center">
            <h2 class="fw-bold"><i class="fas fa-graduation-cap me-2 text-primary"></i>Grade Student Work</h2>
            <a href="/Teacher-Assignments.html" class="btn btn-outline-secondary rounded-pill">Back</a>
        </header>

        <div class="card grade-card p-4">
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead class="text-muted small text-uppercase">
                        <tr>
                            <th>Student</th>
                            <th>Assignment</th>
                            <th>Submitted On</th>
                            <th>Status</th>
                            <th class="text-end">Action</th>
                        </tr>
                    </thead>
                    <tbody id="submissionList">
                        <tr><td colspan="5" class="text-center py-5">Syncing submissions...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const TOKEN = localStorage.getItem('erp-token');
        async function loadSubmissions() {
            try {
                // Fetches from the online learning router
                const res = await fetch('/api/online-learning/submissions/pending', {
                    headers: { 'Authorization': `Bearer ${TOKEN}` }
                });
                const data = await res.json();
                const list = document.getElementById('submissionList');
                list.innerHTML = data.map(sub => `
                    <tr>
                        <td class="fw-bold">${sub.student_name}</td>
                        <td>${sub.assignment_title}</td>
                        <td class="small">${new Date(sub.submitted_at).toLocaleDateString()}</td>
                        <td><span class="status-badge bg-${sub.status === 'Pending' ? 'pending' : 'graded'}">${sub.status.toUpperCase()}</span></td>
                        <td class="text-end">
                            <a href="/uploads/assignments/${sub.file_name}" target="_blank" class="btn btn-sm btn-light border me-2"><i class="fas fa-eye"></i> View</a>
                            <button class="btn btn-sm btn-primary" onclick="openGradeModal('${sub.id}')">Grade</button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) { console.error(err); }
        }
        document.addEventListener('DOMContentLoaded', loadSubmissions);
    </script>
</body>
</html>