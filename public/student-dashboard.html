<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Student Dashboard - 3D Glass Edition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
    <style>
        :root {
            --primary-dark: #003366; 
            --primary-accent: #1e88e5; 
            --secondary-purple: #5e35b1; 
            --secondary-light: #7a44f2;
            --bg-body: #f0f2f8;
            --glass-bg: rgba(255, 255, 255, 0.75);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f0f2f8 0%, #e0e4f1 100%);
            min-height: 100vh;
            font-size: 14px;
        }

        .dashboard-container { max-width: 1440px; margin: 0 auto; padding: 15px; }

        /* --- 3D Glass Effect --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .profile-card {
            background: linear-gradient(135deg, var(--secondary-light) 0%, var(--secondary-purple) 100%);
            border-radius: 20px;
            padding: 25px;
            color: white;
            box-shadow: 0 10px 30px rgba(94, 53, 177, 0.3);
            margin-bottom: 25px;
        }

        #student-photo {
            width: 100px; height: 100px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
            background: white;
        }

        .nav-card {
            background: var(--secondary-purple) !important;
            border: none;
            border-radius: 15px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .nav-card .card-header {
            color: white;
            font-weight: 600;
            padding: 12px 18px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-group-item {
            background: rgba(255, 255, 255, 0.1) !important;
            color: #f8f9fa !important;
            border: none !important;
            font-size: 13px;
            padding: 10px 22px !important;
            transition: all 0.2s;
            border-left: 3px solid transparent !important;
        }

        .list-group-item:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            border-left: 3px solid var(--primary-accent) !important;
            padding-left: 28px !important;
        }

        @media (max-width: 767px) {
            .mobile-nav-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
            .nav-card .card-header { font-size: 11px; padding: 10px; }
            .list-group-item { font-size: 11px; padding: 8px 12px !important; }
        }
    </style>
</head>
<body>

<div class="dashboard-container">
    <header class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h4 fw-bold text-primary mb-0"><i class="fas fa-university me-2"></i>BCSM Portal</h1>
        <button class="btn btn-danger btn-sm rounded-pill px-4 shadow-sm" onclick="logout()">
            <i class="fas fa-sign-out-alt me-1"></i> Logout
        </button>
    </header>

    <div class="profile-card">
        <div class="row align-items-center text-center text-md-start">
            <div class="col-md-2 mb-3 mb-md-0">
                <img id="student-photo" src="https://placehold.co/100x100?text=Profile" alt="Photo">
            </div>
            <div class="col-md-10">
                <h4 id="welcome-message" class="mb-3 fw-bold">Welcome back, Loading...</h4>
                <div class="row g-3">
                    <div class="col-6 col-md-3"><small class="opacity-75"><i class="fas fa-id-badge me-1"></i> Student ID</small><span id="student-id" class="fw-bold d-block">...</span></div>
                    <div class="col-6 col-md-3"><small class="opacity-75"><i class="fas fa-chalkboard me-1"></i> Grade/Class</small><span id="student-grade" class="fw-bold d-block">...</span></div>
                    <div class="col-6 col-md-3"><small class="opacity-75"><i class="fas fa-list-ol me-1"></i> Roll & Section</small><span class="fw-bold d-block"><span id="student-roll">...</span> / <span id="student-section">...</span></span></div>
                    <div class="col-6 col-md-3"><small class="opacity-75"><i class="fas fa-envelope me-1"></i> Email</small><span id="student-email" class="fw-bold d-block small">...</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3 mobile-nav-grid">
            <div class="card nav-card">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#mAcademics">
                    <span><i class="fas fa-book-open me-2"></i>Academics</span>
                    <i class="fas fa-chevron-down small"></i>
                </div>
                <div id="mAcademics" class="collapse show">
                    <div class="list-group">
                        <a href="/registration-certificate.html" class="list-group-item"><i class="fas fa-certificate me-2"></i>Registration Cert.</a>
                        <a href="/student-class-timetable.html" class="list-group-item"><i class="fas fa-calendar-alt me-2"></i>Class Timetable</a>
                        <a href="/my-exam-schedule.html" class="list-group-item"><i class="fas fa-file-alt me-2"></i>Exam Schedule</a>
                        <a href="/student-admit-card.html" class="list-group-item"><i class="fas fa-id-card-alt me-2"></i>Admit Card</a>
                        <a href="/my-syllabus.html" class="list-group-item"><i class="fas fa-book me-2"></i>Syllabus</a>
                        <a href="/my-assignments.html" class="list-group-item"><i class="fas fa-edit me-2"></i>Assignments</a>
                        <a href="/my-study-material.html" class="list-group-item"><i class="fas fa-file-pdf me-2"></i>Study Material</a>
                        <a href="/my-quiz.html" class="list-group-item"><i class="fas fa-question-circle me-2"></i>Online Quiz</a>
                        <a href="/view-transcript.html" class="list-group-item"><i class="fas fa-poll me-2"></i>View Marks</a>
                        <a href="/my-view-attendance.html" class="list-group-item"><i class="fas fa-user-check me-2"></i>View Attendance</a>
                        <a href="/student-certificate.html" class="list-group-item"><i class="fas fa-award me-2"></i>My Certificate</a>
                    </div>
                </div>
            </div>

            <div class="card nav-card">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#mFinance">
                    <span><i class="fas fa-file-invoice-dollar me-2"></i>Finance</span>
                    <i class="fas fa-chevron-down small"></i>
                </div>
                <div id="mFinance" class="collapse">
                    <div class="list-group">
                        <a href="/online-payment.html" class="list-group-item"><i class="fas fa-credit-card me-2"></i>Pay Fees Online</a>
                        <a href="/my-payment-history.html" class="list-group-item"><i class="fas fa-history me-2"></i>Payment History</a>
                        <a href="/my-fee-receipts.html" class="list-group-item"><i class="fas fa-download me-2"></i>Fee Receipts</a>
                        <a href="/my-scholarship.html" class="list-group-item"><i class="fas fa-graduation-cap me-2"></i>Scholarship Status</a>
                    </div>
                </div>
            </div>

            <div class="card nav-card">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#mLibrary">
                    <span><i class="fas fa-book-reader me-2"></i>Library</span>
                    <i class="fas fa-chevron-down small"></i>
                </div>
                <div id="mLibrary" class="collapse">
                    <div class="list-group">
                        <a href="/library-search.html" class="list-group-item"><i class="fas fa-search me-2"></i>Search Books</a>
                        <a href="/library-issued.html" class="list-group-item"><i class="fas fa-book me-2"></i>Issued Books</a>
                        <a href="/mylibrary-history.html" class="list-group-item"><i class="fas fa-list me-2"></i>Reading History</a>
                        <a href="/mylibraryfines.html" class="list-group-item"><i class="fas fa-exclamation-triangle me-2"></i>View Fines</a>
                        <a href="/myebooks.html" class="list-group-item"><i class="fas fa-laptop me-2"></i>e-Resources</a>
                    </div>
                </div>
            </div>

            <div class="card nav-card">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#mServices">
                    <span><i class="fas fa-concierge-bell me-2"></i>Services</span>
                    <i class="fas fa-chevron-down small"></i>
                </div>
                <div id="mServices" class="collapse">
                    <div class="list-group">
                        <a href="/my-bus.html" class="list-group-item"><i class="fas fa-route me-2"></i>View Bus Route</a>
                        <a href="/mybus-tracker.html" class="list-group-item"><i class="fas fa-map-marker-alt me-2"></i>Track Bus (Live)</a>
                        <a href="/mymess-menu.html" class="list-group-item"><i class="fas fa-utensils me-2"></i>View Mess Menu</a>
                        <a href="/myhostel-leave.html" class="list-group-item"><i class="fas fa-bed me-2"></i>Hostel Leave</a>
                    </div>
                </div>
            </div>

            <div class="card nav-card">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#mProfile">
                    <span><i class="fas fa-user-circle me-2"></i>Profile & More</span>
                    <i class="fas fa-chevron-down small"></i>
                </div>
                <div id="mProfile" class="collapse">
                    <div class="list-group">
                        <a href="/student-profile.html" class="list-group-item"><i class="fas fa-user me-2"></i>Full Profile</a>
                        <a href="/change-password.html" class="list-group-item"><i class="fas fa-key me-2"></i>Change Password</a>
                        <a href="/apply-leave.html" class="list-group-item"><i class="fas fa-paper-plane me-2"></i>Apply for Leave</a>
                        <a href="/leave-status.html" class="list-group-item"><i class="fas fa-clock me-2"></i>Leave Status</a>
                        <a href="/my-id-card.html" class="list-group-item"><i class="fas fa-id-card me-2"></i>My ID Card</a>
                        <a href="/my-school-calendar.html" class="list-group-item"><i class="fas fa-calendar-check me-2"></i>Event Calendar</a>
                        <a href="/my-messages.html" class="list-group-item"><i class="fas fa-comment-dots me-2"></i>Messages</a>
                        <a href="/my-feedback.html" class="list-group-item"><i class="fas fa-bullhorn me-2"></i>Feedback</a>
                        <a href="/gallery.html" class="list-group-item"><i class="fas fa-images me-2"></i>School Gallery</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="card glass-card h-100 p-3">
                        <h6 class="fw-bold text-primary border-bottom pb-2"><i class="fas fa-chart-pie me-2"></i>Finance Summary</h6>
                        <div class="d-flex justify-content-between my-2"><span>Total Due:</span> <span id="fee-due" class="fw-bold">...</span></div>
                        <div class="d-flex justify-content-between my-2"><span>Total Paid:</span> <span id="fee-paid" class="text-success fw-bold">...</span></div>
                        <div class="d-flex justify-content-between my-2"><span>Balance:</span> <span id="fee-balance" class="text-danger fw-bold">...</span></div>
                        <a href="/online-payment.html" class="btn btn-primary btn-sm w-100 mt-2 shadow-sm"><i class="fas fa-wallet me-2"></i>Pay Now</a>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card glass-card h-100 p-3">
                        <h6 class="fw-bold text-primary border-bottom pb-2"><i class="fas fa-bell me-2"></i>Notice Board</h6>
                        <ul class="list-unstyled small mb-0" id="notice-board-list">
                            <li><i class="fas fa-spinner fa-spin me-2"></i>Loading announcements...</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card glass-card mt-4 p-3">
                <h6 class="fw-bold mb-3"><i class="fas fa-chalkboard-teacher me-2"></i>My Assigned Teachers</h6>
                <div id="my-teachers-list" class="row g-2">
                    <div class="col-12 text-muted small">Loading teachers...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/global-config.js"></script>
<script>
    function logout() { localStorage.clear(); window.location.href = '/login.html'; }

    async function authFetch(url) {
        const token = localStorage.getItem('erp-token');
        if (!token) logout();
        const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
        if (res.status === 401) logout();
        return res.json();
    }

    async function init() {
        const sid = localStorage.getItem('student_id') || localStorage.getItem('profile-id');
        if (!sid) return;

        try {
            const p = await authFetch(`/api/students/${sid}`);
            document.getElementById('welcome-message').innerHTML = `Hi, ${p.first_name || 'Student'}! ðŸ‘‹`;
            document.getElementById('student-id').textContent = p.admission_id || sid;
            document.getElementById('student-grade').textContent = p.course_name || 'N/A';
            document.getElementById('student-roll').textContent = p.roll_number || 'N/A';
            document.getElementById('student-section').textContent = p.batch_name || 'N/A';
            document.getElementById('student-email').textContent = p.email || 'N/A';
            if(p.profile_image_path) document.getElementById('student-photo').src = p.profile_image_path;

            const f = await authFetch(`/api/students/${sid}/fees`);
            document.getElementById('fee-due').textContent = `â‚¹${f.total_billed || 0}`;
            document.getElementById('fee-paid').textContent = `â‚¹${f.total_paid || 0}`;
            document.getElementById('fee-balance').textContent = `â‚¹${f.balance_due || 0}`;

            const t = await authFetch(`/api/students/${sid}/teachers`);
            document.getElementById('my-teachers-list').innerHTML = t.map(i => `
                <div class="col-6 col-md-3">
                    <div class="p-2 border rounded bg-white text-center small shadow-sm">
                        <i class="fas fa-user-circle text-primary mb-1"></i><br>
                        <b>${i.full_name}</b><br>
                        <span class="text-muted" style="font-size:10px">${i.subject_name}</span>
                    </div>
                </div>
            `).join('') || 'No teachers found.';

            const n = await authFetch(`/api/announcements/role/student`);
            document.getElementById('notice-board-list').innerHTML = n.slice(0, 3).map(i => `
                <li class="border-bottom mb-2 pb-1">
                    <i class="fas fa-info-circle text-accent me-2"></i>
                    <b>${i.title}</b><br>
                    <small class="text-muted ps-4">${new Date(i.created_at).toDateString()}</small>
                </li>
            `).join('') || 'No notices.';

        } catch (e) { console.error("Init Error:", e); }
    }
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>