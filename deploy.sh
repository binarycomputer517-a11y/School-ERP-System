#!/bin/bash

# --- ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ---
SERVER_USER="root"
SERVER_IP="72.61.140.252"
REMOTE_DEST="/var/www/html/public/"

echo "ЁЯЪА рж╕рзНржЯрзБржбрзЗржирзНржЯ ржкрзЛрж░рзНржЯрж╛рж▓ ржбрзЗржкрзНрж▓рзЯржорзЗржирзНржЯ рж╢рзБрж░рзБ рж╣ржЪрзНржЫрзЗ..."

# рзз. ржлрзНрж░ржирзНржЯржПржирзНржб ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб (HTML, JS)
echo "ЁЯУж ржлрзНрж░ржирзНржЯржПржирзНржб ржлрж╛ржЗрж▓ ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗ..."
scp ./public/*.html ./public/*.js $SERVER_USER@$SERVER_IP:$REMOTE_DEST

# рзи. ржлрзЛрж▓рзНржбрж╛рж░ рж╕рж┐ржЩрзНржХ (CSS & JS)
echo "ЁЯОи ржбрж┐ржЬрж╛ржЗржи ржУ рж▓ржЬрж┐ржХ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ..."
scp -r ./public/css ./public/js $SERVER_USER@$SERVER_IP:$REMOTE_DEST

# рзй. ржмрзНржпрж╛ржХржПржирзНржб рж░рзБржЯрж╕ (Routes) ржЖржкржбрзЗржЯ
echo "ЁЯФЩ ржмрзНржпрж╛ржХржПржирзНржб рж░рзБржЯрж╕ рж╕рж┐ржЩрзНржХ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ..."
scp -r ./routes $SERVER_USER@$SERVER_IP:/var/www/html/

# рзк. рж╕рж╛рж░рзНржнрж╛рж░ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ (PM2 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ)
echo "ЁЯФД рж╕рж╛рж░рзНржнрж╛рж░ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ..."
ssh $SERVER_USER@$SERVER_IP "pm2 restart all || systemctl restart node-app"

if [ $? -eq 0 ]; then
    echo "----------------------------------------------"
    echo "тЬЕ ржорж┐рж╢ржи рж╕рж╛ржХрж╕рзЗрж╕ржлрзБрж▓! ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб ржУ рж╕рж╛рж░рзНржнрж╛рж░ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ рж╣рзЯрзЗржЫрзЗред"
    echo "ЁЯМР рж▓рж╛ржЗржн ржжрзЗржЦрзБржи: http://$SERVER_IP/student-dashboard.html"
    echo "----------------------------------------------"
else
    echo "тЭМ ржХрж┐ржЫрзБ ржПржХржЯрж╛ ржнрзБрж▓ рж╣рзЯрзЗржЫрзЗ! ржХрж╛ржирзЗржХрж╢ржи ржЪрзЗржХ ржХрж░рзБржиред"
fi